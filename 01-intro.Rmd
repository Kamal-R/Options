# Introduction 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

if ( !require("tidyverse") )   { install.packages("tidyverse") };    require(tidyverse)
if ( !require("kableExtra") )  { install.packages("kableExtra") };   require(kableExtra)
if ( !require("ggdark") )      { install.packages("ggdark") };       require(ggdark)
if ( !require("formattable") ) { install.packages("formattable") };  require(formattable)

options(kableExtra.html.bsTable = T)
```

## Options on Expiry Day
```{r Call-Demo, echo=FALSE}
Call_cost <- 5; Put_cost <- 5
Call_K <- 230; Put_K <- 180
Current_price <- 200
Future_price <- 240
```
Suppose that stock of Company XYZ is trading at `r currency(Current_price)`, and that we see the following two options available for purchase. 

1. A `r currency(Call_K)` strike call that expires in 60 days and costs `r currency(Call_cost)`.
2. A `r currency(Put_K)` strike put that expires in 60 days and costs `r currency(Put_cost)`. 

The call empowers its buyer to purchase shares of Company XYZ for `r currency(Call_K)` in 60 days. The put empowers its buyer to sell shares of Company XYZ for `r currency(Put_K)` in 60 days. After the 60th day, the option expires and is worthless. Options are available on exchanges, so people can buy and sell them before they expire to avoid having them expire for nothing. Since options pricing can get complicated, we'll only be considering the profit (or loss) a buyer can experience on the expiry date of the option in this chapter. 

## Call Options
```{r Call-Option-Payoff-Plot, echo=FALSE, fig.height = 4, fig.width = 6, fig.align = "center", message=FALSE}
Call_cost <- 5
Call_K <- 230
x_min <- 200; x_max = 250
Call_Payoff_Plot <- tibble( "Call_x" = seq(from = x_min, to = x_max, by = 1),
                            "Call_y" = -Call_cost + (Call_x > Call_K)*(Call_x-Call_K) )

ggplot() + 
  geom_line(data = Call_Payoff_Plot, aes(Call_x, Call_y, color = "Shares"), linetype = "solid") +
  geom_line(data = Call_Payoff_Plot, aes(Call_x, rep(0,length(Call_x)), color = "Breakeven"), linetype = "dashed") +
  geom_line(data = Call_Payoff_Plot, aes(x = Call_K + Call_cost, 
                                         y = seq(from = -Call_cost, to = x_max-Call_K, length=length(Call_x)), 
                                         color = "Breakeven"),
                                         linetype = "dashed") +
  scale_y_continuous(label = scales::dollar) +
  scale_x_continuous(label = scales::dollar) + 
  labs(title = "Payoff Of The XYZ Call Option On Expiry",
       x = "Stock Price",
       y = "Profit Per Share") +
  scale_color_manual(values = c('Shares'='white','Breakeven'='white','Breakeven'='white'),
                     labels = c("Profit Per Share",
                                paste0("Breakeven Price = $", Call_K + Call_cost),
                                paste0("Breakeven Price = $", Call_K + Call_cost) ),
                     guide = "legend") + 
  guides(color = guide_legend(override.aes = list(linetype = c("solid", "dashed")))) + 
  theme_classic() + 
  dark_mode() + 
  theme(plot.title = element_text(hjust = 0.5, face="bold", margin = margin(10, 0, 10, 0)),
        legend.justification=c(0,1), 
        legend.position=c(0,1), 
        legend.title = element_blank(),
        legend.key=element_rect(fill="black"),
        text = element_text(size=16), 
        panel.border = element_blank(), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), 
        panel.background = element_blank(),
        axis.line = element_line(colour = "black"),
        axis.title.x = element_text(margin = unit(c(4, 0, 0, 0), "mm")),
        axis.title.y = element_text(margin = unit(c(0, 4, 0, 0), "mm"), angle = 90)) 

# plot(x = Call_x, y = -option_cost + (Call_x > Call_K)*(Call_x-Call_K),
#      type = 'l', lwd = 3,
#      xlab = "Stock Price", ylab = "Profit Per Share",
#      main = "Payoff Of The Call Option On Expiry")
# abline(v = Call_K + option_cost, lty = 2, lwd = 1)
# abline(h = 0, lty = 2, lwd = 1)
# legend("topleft", c("Profit Per Share",
#                     paste0("Breakeven Price = $", Call_K + option_cost)),
#        lty = c("solid", "dotdash"), 
#        lwd = c(2, 2), cex = 0.75,
#        col=c("black", "black"), bty = "n") 

```

We'll use payoff diagrams to help visualize options. Payoff diagrams show how much money an investment makes at different prices of Company XYZ's shares. Our first payoff diagram shows the profit or loss of a call with a `r currency(Call_K)` strike that costs `r currency(Call_cost)` on its expiry date. Reading payoff diagrams is not too bad - suppose the shares are worth `r currency(Future_price)` at expiry. The buyer can use the call to purchase shares for `r currency(Call_K)` and immediately sell them for `r currency(Future_price)` This is a gain of `r currency(Future_price)` - `r currency(Call_K)` = `r currency(Future_price-Call_K)` per share. Remembering that he paid `r currency(Call_cost)` for the call, the buyer's profits are `r currency(Future_price-Call_K)` - `r currency(Call_cost)` = `r currency(Future_price-Call_K-Call_cost)` per share. If we look at the payoff diagram, the buyer's profit when the stock is at `r currency(Future_price)` is indeed `r currency(Future_price-Call_K-Call_cost)`. 

There are a couple more things on the payoff diagram we should make note of. The first is that even though the call lets the buyer purchase shares for `r currency(Call_K)`, he doesn't start making money until they reach `r currency(Call_K+Call_cost)` because he has to make back the `r currency(Call_cost)` he spent buying the option. `r currency(Call_K+Call_cost)` is such an important value that it has its own name - it's the breakeven price. The second is that the most the buyer can lose is the `r currency(Call_cost)` he spent buying the call. If the shares are `r currency(Call_K-30)`, `r currency(Call_K-50)`, or even `r currency(Call_K-Call_K)`, the buyer can just let the call expire and can never lose more than the `r currency(Call_cost)` he spent on the call. This places a hard limit on the amount of money the buyer can lose, regardless of what happens to Apple's shares. We'll come back to this idea of having limited downside again and again while trying to understand how to use options The third is that even with limited downside, the buyer still gets dollar for dollar participation in the upside of the stock on the expiry date of the call (after recovering the `r currency(Call_cost)` it cost to buy). 

This combination of limited downside and full participation to the upside is what makes options such a powerful tool to have in your investing toolkit. But we don't get this power for free. The day after the option expires, it becomes worthless. In exchange for giving us limited downside and full participation to the upside, the option puts us on the clock. We need the price to move in our favor before the option expires to make money. Lots of options investing strategies try to mitigate the (very negative) impact this clock can have on options investments, and we'll discuss some of them in a later chapter. For now, we want to focus on the big ideas, which are: having limited downside, having full participation to the upside, and being time-limited.

Let's recap the decisions that a buyer of a call option could make at different prices of Company XYZ's stock. If the stock is below the strike price of `r currency(Call_K)` on the expiry date of the call, the buyer will not exercise the call. If he did, he would be buying the shares for more than they are worth on the market, and he would not make any money. If the stock is above `r currency(Call_K)` on expiry, he will exercise the call because he is buying shares for less than they are worth on the market and can immediately sell them at the higher market price. However, the buyer only makes profits after recovering the `r currency(Call_cost)` cost of the call. If the shares are between `r currency(Call_K)` and `r currency(Call_K+Call_cost)`, he is recovering some of the cost of the call, but still losing money. If the shares are above `r currency(Call_K+Call_cost)`, he will profit from the call. 

The payoff diagram summarizes all of this information, and helps us see the price levels that go along with these decisions very quickly. This makes drawing payoff diagrams is one of the easiest and most effective ways that we can use to help ourselves understand how to trade options. While we won't draw the payoff diagram for every option strategy we talk about in this book, everything will make much more sense if you draw the missing payoff diagrams before reading the discussions on them. 

## Put Options
```{r Put-Demo, echo=FALSE}
Call_cost <- 5; Put_cost <- 5
Call_K <- 230; Put_K <- 180
Future_price <- 150
```

Puts are a little strange if you haven't seen them before. Instead of giving their buyer the option to buy shares at a specific price, they give the buyer the option to sell shares at a specific price. This is the opposite of how we're used to thinkng, so don't worry if it doesn't click right away. 

We're looking at a put with a `r currency(Put_K)` strike that cost `r currency(Put_cost)`. This put gives its buyer the option to sell shares of Company XYZ for `r currency(Put_K)` on its expiry date. The buyer makes money if the stock is below `r currency(Put_K)`. As an example, suppose the shares are trading at `r currency(Future_price)` on the put's expiry date. Then, the buyer can purchase them for `r currency(Future_price)` and sell them for `r currency(Put_K)`, for an instant gain of `r currency(Put_K-Future_price)`. Remembering that the put cost `r currency(Put_cost)`, he is left with a profit of `r currency(Put_K-Future_price-Put_cost)`. Looking at the payoff diagram, the buyer does indeed profit by `r currency(Put_K-Future_price-Put_cost)` per share when the shares are at `r currency(Future_price)`. 


```{r Put-Option-Payoff-Plot, echo=FALSE, fig.height = 4, fig.width = 6, fig.align = "center"}
Put_cost <- 5
Put_K <- 180
x_min <- 150; x_max = 200

Call_Payoff_Plot <- tibble( "Put_x" = seq(from = x_min, to = x_max, by = 1),
                            "Put_y" = -Put_cost - (Put_x < Put_K) * (Put_x - Put_K),  )

ggplot() + 
  geom_line(data = Call_Payoff_Plot, aes(Put_x, Put_y, color = "Shares"), linetype = "solid") +
  geom_line(data = Call_Payoff_Plot, aes(Put_x, rep(0,length(Put_x)), color = "Breakeven"), linetype = "dashed") +
  geom_line(data = Call_Payoff_Plot, aes(x = Put_K - Put_cost, 
                                         y = seq(from = -Put_cost, to = x_max-Put_K, length=length(Put_x)), 
                                         color = "Breakeven"),
                                         linetype = "dashed") +
  scale_y_continuous(label = scales::dollar) +
  scale_x_continuous(label = scales::dollar) + 
  labs(title = "Payoff Of The XYZ Put Option On Expiry",
       x = "Stock Price",
       y = "Profit Per Share") +
  scale_color_manual(values = c('Shares'='white','Breakeven'='white','Breakeven'='white'),
                     labels = c("Profit Per Share",
                                paste0("Breakeven Price = $", Put_K - Put_cost),
                                paste0("Breakeven Price = $", Put_K - Put_cost) ),
                     guide = "legend") + 
  guides(color = guide_legend(override.aes = list(linetype = c("solid", "dashed")))) + 
  theme_classic() + 
  dark_mode() + 
  theme(plot.title = element_text(hjust = 0.5, face="bold", margin = margin(10, 0, 10, 0)),
        legend.justification=c(0,1), 
        legend.position=c(0,1), 
        legend.title = element_blank(),
        legend.key=element_rect(fill="black"),
        text = element_text(size=16), 
        panel.border = element_blank(), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), 
        panel.background = element_blank(),
        axis.line = element_line(colour = "black"),
        axis.title.x = element_text(margin = unit(c(4, 0, 0, 0), "mm")),
        axis.title.y = element_text(margin = unit(c(0, 4, 0, 0), "mm"), angle = 90)) 

# plot(x = Put_x, y = -option_cost - (Put_x < Put_K) * (Put_x - Put_K), 
#      type = 'l', lwd = 3,
#      xlab = "Stock Price", ylab = "Profit per Share",
#      main = "Payoff of The Put Option On Expiry")
# 
# abline(v = Put_K - option_cost, lty = 2, lwd = 1)
# abline(h = 0, lty = 2, lwd = 1)
# 
# legend("topright", c("Profit Per Share",
#                     paste0("Breakeven Price = $", Put_K - option_cost)),
#        lty = c("solid", "dotdash"), 
#        lwd = c(2, 2), cex = 0.75,
#        col=c("black", "black"), bty = "n") 

```     

The breakeven of the put is `r currency(Put_K-Put_cost)`, because the buyer needs the shares to fall by `r paste0(Put_cost)` to recover the cost of the put. Similar to calls, the downside of a put is limited to its cost and they are time-limited (they have an expiry date). Unlike calls, their dollar-for-dollar "upside" participation happens when the stock they're following goes down. This is the big idea behind puts - they make money when prices go down. This idea opens up so many new investing strategies to us that the rest of this book is devoted to working through some of them. The big picture idea is that mixing and matching puts, calls, and shares lets us control how much our portfolio goes up (or down) when market prices go up. We'll come back to this idea every time we're going through an options strategy and working through how we can use it to help us construct risk-managed investments.



## Example - Options on Apple

Let’s look at options on Apple stock around 11:00am on August 28, 2019. Apple has options listed for a bunch of different dates: September 20, 2019, October 18, 2019, November 15, 2019, December 20, 2019, January 17, 2020 and so on. These are expiry dates - the last day a buyer can exercise their right to buy/sell a stock at the strike. Options on stocks are almost always for 100 shares - calls let their buyer purchase 100 shares at the strike, and puts let their buyer sell 100 shares at the strike. 

```{r Apple-205-Option-Price, echo = FALSE}
Current_price <- 205.44
Call_K <- 205
Put_K <- 205
Call_cost <- 6.84
Put_cost <- 6.10
```

Apple is trading at `r currency(Current_price)`. The September 20, 2019 call with a `r currency(Call_K)` strike lets its buyer purchase 100 shares of Apple for `r currency(Call_K)` each on September 20, 2019. It is trading for `r currency(100*Call_cost)` - the buyer is paying `r currency(100*Call_cost)`/100 = `r currency(Call_cost)` per share for this call. The September 20, 2019 put lets its buyer sell 100 shares of Apple for `r currency(Current_price)` each on September 20, 2019. It is trading for `r currency(100*Put_cost)` - the buyer is paying `r currency(100*Put_cost)`/100 = `r currency(Put_cost)` per share. 

```{r Apple_Call_Option_Payoff, echo=FALSE, fig.height = 4, fig.width = 6, fig.align = "center"}
Call_cost <- 6.84
Call_K <- 205
Current_price <- 205.44
x_min = 180; x_max = 225
Call_x <- seq(from = x_min, to = x_max, by = 1)

Call_Payoff_Plot <- tibble( "Call_x" = seq(from = x_min, to = x_max, by = 1),
                            "Call_y" = -Call_cost + (Call_x > Call_K)*(Call_x-Call_K) )

ggplot() + 
  geom_line(data = Call_Payoff_Plot, aes(Call_x, Call_y, color = "Shares"), linetype = "solid") +
  geom_line(data = Call_Payoff_Plot, aes(Call_x, rep(0,length(Call_x)), color = "Breakeven"), linetype = "dashed") +
  geom_line(data = Call_Payoff_Plot, aes(x = Call_K + Call_cost, 
                                         y = seq(from = -Call_cost, to = x_max-Call_K, length=length(Call_x)), 
                                         color = "Breakeven"),
                                         linetype = "dashed") +
  scale_y_continuous(label = scales::dollar) +
  scale_x_continuous(label = scales::dollar) + 
  labs(title = "Payoff Of The XYZ Call Option On Expiry",
       x = "Stock Price",
       y = "Profit Per Share") +
  scale_color_manual(values = c('Shares'='white','Breakeven'='white','Breakeven'='white'),
                     labels = c("Profit Per Share",
                                paste0("Breakeven Price = $", Call_K + Call_cost),
                                paste0("Breakeven Price = $", Call_K + Call_cost) ),
                     guide = "legend") + 
  guides(color = guide_legend(override.aes = list(linetype = c("solid", "dashed")))) + 
  theme_classic() + 
  dark_mode() + 
  theme(plot.title = element_text(hjust = 0.5, face="bold", margin = margin(10, 0, 10, 0)),
        legend.justification=c(0,1), 
        legend.position=c(0,1), 
        legend.title = element_blank(),
        legend.key=element_rect(fill="black"),
        text = element_text(size=16), 
        panel.border = element_blank(), 
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), 
        panel.background = element_blank(),
        axis.line = element_line(colour = "black"),
        axis.title.x = element_text(margin = unit(c(4, 0, 0, 0), "mm")),
        axis.title.y = element_text(margin = unit(c(0, 4, 0, 0), "mm"), angle = 90)) 

# plot(x = Call_x, y = -Call_cost + (Call_x > Call_K)*(Call_x-Call_K), 
#      type = 'l', lwd = 3,
#      xlab = "Apple's Stock Price", ylab = "Profit Per Share",
#      main = "Payoff Of The Call Option On Expiry")
# abline(v = Call_K + option_cost, lty = 2, lwd = 1)
# abline(h = 0, lty = 2, lwd = 1)
# legend("topleft", c("Profit Per Share",
#                     paste0("Breakeven Price = $", Call_K + Call_cost)),
#        lty = c("solid", "dotdash"), 
#        lwd = c(2, 2), cex = 0.75,
#        col=c("black", "black"), bty = "n") 

```

Here's a payoff diagram of this call option. Below `r currency(Call_K)`, the buyer loses `r currency(Call_cost)` per share, which is what he paid for the call. This is the entire cost of the call, since it expires worthless. Since he paid `r currency(Call_cost)` per share for the call, he has to make `r currency(Call_cost)` back before he becomes profitable. Therefore, his breakeven is `r currency(Call_K)` + `r currency(Call_cost)` = `r currency(Call_cost+Call_K)`. This is reflected in the payoff diagram, where his profits are negative when the stock is below `r currency(Call_cost+Call_K)` and positive when it is above `r currency(Call_cost+Call_K)`.

This next table compares how much money a buyer can make with 100 shares of Apple at `r currency(Current_price)` and 1 call on Apple shares at `r currency(Call_cost)` (with a strike price of `r currency(Call_K)` that expires on September 20, 2019). The relative return column tell us how much the call owner participates in the upside (or downside) experienced by the shareholder. This last column is the most important - it will help us understand how to size our option investments. To give the dollar amounts some context, 100 shares of Apple at `r currency(Current_price)` will cost `r currency(Current_price)` x 100 = `r currency(100*Current_price)` to buy, and one call that gives the buyer the option to buy 100 shares of Apple at `r currency(Call_K)` on September 20, 2019 will cost `r currency(Call_cost)` x 100 = `r currency(100*Call_cost)`.

``` {r Apple_Call_Table, echo = FALSE, tab = NULL}
Apple_Share_Price <- 205.44
Apple_Call_Strike_Price <- 205
Apple_Call_Cost <- 6.84
Apple_Stock_Price <- c( 150, 180, 184.90, 198.90, 211.84, 218.68, 225.98, 240 )

Apple_Shares_Percent_Return <- (Apple_Stock_Price - Apple_Share_Price) / Apple_Share_Price
Apple_Shares_Dollar_Return <- 100 * (Apple_Stock_Price - Apple_Share_Price)

Apple_Calls_Percent_Return <- 
  ( pmax( 0, (Apple_Stock_Price - Apple_Call_Strike_Price ) ) - Apple_Call_Cost ) / Apple_Call_Cost 
Apple_Calls_Dollar_Return <- 100  * ( pmax( 0, (Apple_Stock_Price - Apple_Call_Strike_Price ) ) - Apple_Call_Cost )
  
Apple_Call_Table <- tibble( "Stock Price" = currency(Apple_Stock_Price),
                            "Percent Return " = percent(Apple_Shares_Percent_Return),
                            "Dollar Return " = scales::dollar(Apple_Shares_Dollar_Return, negative_parens = TRUE), 
                            " Percent Return" = percent(Apple_Calls_Percent_Return),
                            " Dollar Return" =  scales::dollar(Apple_Calls_Dollar_Return, negative_parens = TRUE), 
                            "Calls/Shares" = sign(Apple_Calls_Dollar_Return) * 
                              percent(Apple_Calls_Dollar_Return / Apple_Shares_Dollar_Return ) )

add_header_above( kable_styling( knitr::kable(x = Apple_Call_Table, booktabs = T,
                                                          caption = "Returns when Investing in 100 Shares or 1 Call"), 
                                             bootstrap_options = c("striped", "hover", "bordered", 
                                                                   "condensed", "responsive"),
                                             latex_options = c("striped"),
                                             full_width = FALSE ),
                 c("Stock" = 1, "If We Own 100 Shares" = 2, "If We Own 1 Call" = 2, "Relative Return" = 1) )
```

The buyer can make a ton of money with this call. To double his investment, he only needs to recover the `r currency(Apple_Call_Cost)` it cost to buy the call (done at the breakeven of `r currency(Apple_Call_Strike_Price)` + `r currency(Apple_Call_Cost)` = `r currency(Apple_Call_Strike_Price+Apple_Call_Cost)`), and have the shares go up another `r currency(Apple_Call_Cost)` to `r currency(Apple_Call_Strike_Price+Apple_Call_Cost)` + `r currency(Apple_Call_Cost)` = `r currency(Apple_Call_Strike_Price+2*Apple_Call_Cost)`. Remember that Apple was trading for `r currency(Apple_Share_Price)` when he bought the call. If he bought shares instead, the buyer would make (`r currency(Apple_Call_Strike_Price+2*Apple_Call_Cost)` - `r currency(Apple_Share_Price)`) / `r currency(Apple_Share_Price)` = `r percent(2*Apple_Call_Cost/Apple_Share_Price)` on his investment. By using calls, he makes (`r currency(Apple_Call_Strike_Price+2*Apple_Call_Cost)` - `r currency(Apple_Call_Strike_Price)` - `r currency(Apple_Call_Cost)`) / `r currency(Apple_Call_Cost)` = `r percent(Apple_Call_Cost/Apple_Call_Cost)`. `r percent(Apple_Call_Cost/Apple_Call_Cost)` seems so much larger than `r percent(2*Apple_Call_Cost/Apple_Share_Price)` that this seems impossible, but the way to think about this is by looking at how much of the upside in the stock the call buyer participates in. 
